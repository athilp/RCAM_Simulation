clear
clc
close all

% x0 = [85; 0; 1.2713; 0; 0; 0; 0; 0.0149; 0; 50];
% x0 = [84.9904919901061;
%     6.45650157105089e-09;
%     1.27132657706395;
%     -3.70270693429323e-09;
%     1.66020791910590e-08;
%     2.74340260501151e-10;
%     -6.98873738330964e-08;
%     0.0149573413634983;
%     -6.94260381093635e-09];
% 
% u0_1 =  [9.90238247235141e-14;
%         -0.178007601167460;
%         2.29811638332049e-13;
%         0.0820834176200896;
%         0.0820834176199621];
% 
% x0 = [84.9991005246808;
% -0.0510405810493896;
% -0.387691700065233;
% -0.236792408149648;
% -0.127810490183226;
% -0.0777885334513133;
% 0.261799390000057;
% -0.00456109546113151;
% 2.16588161319220e-13];

x0 = [227.561443788829;
-1.10002515834088e-09;
-33.4034324692573;
-1.22516889676411e-09;
2.15490626921783e-08;
-1.10109253983274e-08;
-1.00273881994871e-09;
-0.145747773011802;
-5.61677961209984e-10];

u0_2 = [-6.32224925618250e-08;
-0.0282552238735963;
-1.50599222814056e-07;
0.1;
0.475656557862387];

u0_1 = [-6.32224925618250e-08;
-0.0282552238735963;
-1.50599222814056e-07;
0.475655948615958;
0.475656557862387];

% u0_2 = [0.306377686292827;
% -0.108396489077950;
% 0.0634601413304797;
% 0.0780955748725682;
% 0.0690298950017762];

%Dallas Coordinated Turn
% x0 = [84.9905864667274;
%           0.38039129618181;
%           1.20644705796275;
%      -2.44634519658706e-13;
%        1.9239269261291e-13;
%      -1.37404385609742e-14;
%          0.610865238198105;
%           0.01419411354704;
%      -5.35008088741534e-13];
% 
% u0 = [-0.0864684923608011;
%         -0.185221950120643;
%         -0.184015463240756;
%        0.00136329680911986;
%          0.103574520358126];


% x0 = [84.9905864667274
%           0.38039129618181;
%           1.20644705796275;
%      -2.44634519658706e-13;
%        1.9239269261291e-13;
%      -1.24629828217453e-14;
%          0.610865238198105;
%           0.01419411354704;
%      -5.35008088741534e-13];
% 
% u0_2 =  [-0.0864684923265259;
%         -0.185221950132917;
%         -0.184015463162516;
%        0.00136329678657223;
%          0.103574520292301];

% u0_2 = [0.0130713687794196;
% -0.181902387714569;
% 0.0295368975688976;
% 0.0166229762037059;
% 0.000480359343303789];
% 
% u0_2 = [0.306377994411977;
% -0.108396444975192;
% 0.0634603124804835;
% 0.0780957123272119;
% 0.0690299778490956];


% x0 = zeros(10,1);
% u0 = zeros(5,1);

% x0 = [84.993741395688;
%         -0.394725218936366;
%         -0.952950976955713;
%      -1.67296144627373e-13;
%       5.33964616197956e-14;
%      -4.67750847921043e-14;
%          0.785398163397582;
%        -0.0112115437294478;
%      -1.38005734632249e-13];
% 
% u0 = [0.302400767509776;
%         -0.122714733922953;
%          0.713918302229305;
%          0.385320065219821;
%       2.69321049073501e-17];

% 

% u0 = [0;0;0;0;0];


TF = 300;
dt= 1/50;

lon0 = deg2rad(-122.335167);
lat0 = deg2rad(47.608013);
h0 = 250;
% 
% open_system('RCAMSimulation.slx');

% simulation = sim('RCAMSimulation.slx');
% 
% t = simulation.simX.Time;
% 
% u1 = simulation.simU.Data(:,1);
% u2 = simulation.simU.Data(:,2);
% u3 = simulation.simU.Data(:,3);
% u4 = simulation.simU.Data(:,4);
% u5 = simulation.simU.Data(:,5);
% 
% x1 = simulation.simX.Data(:,1);
% x2 = simulation.simX.Data(:,2);
% x3 = simulation.simX.Data(:,3);
% x4 = simulation.simX.Data(:,4);
% x5 = simulation.simX.Data(:,5);
% x6 = simulation.simX.Data(:,6);
% x7 = simulation.simX.Data(:,7);
% x8 = simulation.simX.Data(:,8);
% x9 = simulation.simX.Data(:,9);
% x10 = simulation.simX.Data(:,10);
% 

% figure;
% plot(t,x10,'Color','bl');`
% xlabel('t(s)');
% ylabel('h (m)')
% grid on;
% 
% geoplot(out.simout.Data(:,1).*(180/pi), out.simout.Data(:,2).*(180/pi),'-*');

t = simulation.simX.Time;
figure;
subplot(10,1,1);
plot(t,out.simX.Data(:,1),'Color','bl');
xlabel('Time(s)');
ylabel('u (m/s)');

subplot(10,1,2);
plot(t,out.simX.Data(:,2),'Color','bl');
xlabel('Time(s)');
ylabel('v (m/s)');

subplot(10,1,3);
plot(t,out.simX.Data(:,3),'Color','bl');
xlabel('Time(s)');
ylabel('w (m/s)');

subplot(10,1,4);
plot(t,out.simX.Data(:,4),'Color','bl');
xlabel('Time(s)');
ylabel('p (rad/s)');

subplot(10,1,5);
plot(t,out.simX.Data(:,5),'Color','bl');
xlabel('Time(s)');
ylabel('q (rad/s)');

subplot(10,1,6);
plot(t,out.simX.Data(:,6),'Color','bl');
xlabel('Time(s)');
ylabel('r (rad/s)');

subplot(10,1,7);
plot(t,out.simX.Data(:,7),'Color','bl');
xlabel('Time(s)');
ylabel('phi (rad)');

subplot(10,1,8);
plot(t,out.simX.Data(:,8),'Color','bl');
xlabel('Time(s)');
ylabel('theta (rad)');

subplot(10,1,9);
plot(t,out.simX.Data(:,9),'Color','bl');
xlabel('Time(s)');
ylabel('psi (rad)');

subplot(10,1,10);
plot(t,out.simout.Data(:,3),'Color','bl');
xlabel('Time(s)');
ylabel('h (m)');
